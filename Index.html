<html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üöÄ DAVINA WISE</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: "Poppins", sans-serif;
            background: linear-gradient(135deg, #0a0f2c, #1b2345);
            color: #fff;
            text-align: center;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 500px;
            margin: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        h1 {
            color: #00e6b8;
            margin-bottom: 10px;
            font-size: 28px;
            font-weight: bold;
        }

        h2 {
            color: #00e6b8;
            margin-bottom: 15px;
            font-size: 18px;
        }

        h3 {
            color: #87ceeb;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .card {
            background: rgba(255, 255, 255, 0.08);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        /* Card-specific border colors */
        .connection-card {
            border-left: 4px solid #00e6b8;
        }

        .balance-card {
            border-left: 4px solid #00e6b8;
        }

        .copy-trading-card {
            border-left: 4px solid #ffa500;
        }

        .stats-card {
            border-left: 4px solid #87ceeb;
        }

        .settings-card {
            border-left: 4px solid #ffd700;
        }

        .current-trade-card {
            border-left: 4px solid #ff6b6b;
        }

        .history-card {
            border-left: 4px solid #00bfa5;
        }

        .log-card {
            border-left: 4px solid #9c27b0;
        }

        label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
            text-align: left;
        }

        input,
        select {
            width: 100%;
            padding: 10px;
            border: none;
            border-radius: 5px;
            outline: none;
            margin-bottom: 10px;
            background: rgba(255, 255, 255, 0.9);
            font-family: "Poppins", sans-serif;
        }

        button {
            background-color: #00e6b8;
            color: #0a0f2c;
            border: none;
            border-radius: 5px;
            padding: 12px 20px;
            font-weight: bold;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
            font-family: "Poppins", sans-serif;
        }

        button:hover {
            background-color: #00bfa5;
            transform: translateY(-2px);
        }

        button:disabled {
            background-color: #666;
            cursor: not-allowed;
            transform: none;
        }

        #clearHistoryBtn {
            background: #ff6b6b;
            color: white;
        }

        #clearHistoryBtn:hover {
            background: #ff5252;
        }

        #status {
            color: #aaa;
            margin-top: 10px;
            font-weight: bold;
        }

        #log {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            font-size: 14px;
            height: 200px;
            overflow-y: auto;
            text-align: left;
            line-height: 1.4;
        }

        #lastResult {
            font-weight: bold;
            font-size: 16px;
            margin-top: 10px;
        }

        .profit-loss {
            margin-top: 15px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
        }

        .positive {
            color: #00e6b8;
            font-weight: bold;
        }

        .negative {
            color: #ff6b6b;
            font-weight: bold;
        }

        .neutral {
            color: #ffffff;
            font-weight: bold;
        }

        #countdown {
            color: #ffd700;
            font-weight: bold;
            font-size: 16px;
        }

        #currentStakeDisplay {
            color: #00e6b8;
            font-weight: bold;
        }

        /* Log message colors */
        #log .win { color: #00e6b8; }
        #log .loss { color: #ff6b6b; }
        #log .info { color: #87ceeb; }
        #log .warning { color: #ffd700; }
        #log .error { color: #ff6b6b; }
        #log .copy { color: #ffa500; }

        .buttons {
            margin-top: 20px;
        }

        .balance-card h2 {
            margin-bottom: 15px;
        }

        .balance-card p {
            margin: 8px 0;
            font-size: 18px;
        }

        /* Statistics Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
        }

        .stat-label {
            color: #ccc;
        }

        /* Copy Trading */
        .copied-accounts {
            margin-top: 15px;
        }

        .account-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            margin: 8px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border-left: 4px solid #00e6b8;
        }

        .account-info {
            text-align: left;
            flex-grow: 1;
            margin-right: 10px;
        }

        .account-name {
            font-weight: bold;
            color: #00e6b8;
            font-size: 14px;
        }

        .account-status {
            font-size: 12px;
            color: #ccc;
            margin-top: 4px;
        }

        .account-controls {
            display: flex;
            gap: 5px;
            align-items: center;
        }

        .start-btn, .stop-btn, .remove-btn {
            padding: 6px 10px !important;
            font-size: 12px !important;
            margin: 0 !important;
            min-width: 40px;
        }

        .start-btn {
            background-color: #00e6b8 !important;
        }

        .start-btn:disabled {
            background-color: #666 !important;
            cursor: not-allowed;
        }

        .stop-btn {
            background-color: #ff6b6b !important;
            color: white !important;
        }

        .stop-btn:disabled {
            background-color: #666 !important;
            cursor: not-allowed;
        }

        .remove-btn {
            background-color: #ff4757 !important;
            color: white !important;
        }

        .remove-btn:hover {
            background: #ff5252;
        }

        /* Trade History Styles */
        .trade-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .trade-main {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .trade-digit {
            color: #ffffff;
        }

        .trade-stake {
            color: #cccccc;
            font-size: 11px;
        }

        .trade-pnl {
            font-weight: bold;
            font-size: 12px;
        }

        .win-color {
            color: #00e6b8 !important;
        }

        .loss-color {
            color: #ff6b6b !important;
        }

        .trade-time {
            color: #888;
            font-size: 10px;
            margin-top: 2px;
        }

        .trade-item {
            display: flex;
            flex-direction: column;
            padding: 8px;
            margin: 5px 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 5px;
            font-size: 12px;
        }

        .trade-win {
            border-left: 3px solid #00e6b8;
            background: rgba(0, 230, 184, 0.1);
        }

        .trade-loss {
            border-left: 3px solid #ff6b6b;
            background: rgba(255, 107, 107, 0.1);
        }

        /* Current Trade Section */
        .current-trade-card p {
            margin: 8px 0;
            font-size: 14px;
        }

        /* Responsive Design */
        @media (max-width: 600px) {
            .container {
                max-width: 100%;
                padding: 10px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            button {
                padding: 10px 15px;
                font-size: 14px;
            }
            
            .card {
                padding: 15px;
            }
            
            h1 {
                font-size: 24px;
            }
            
            .account-item {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .account-controls {
                margin-top: 10px;
                align-self: flex-end;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üöÄ DAVINA WISE</h1>
        
        <!-- 1. Connection Tab -->
        <div class="card connection-card">
            <h2>üîó Connection</h2>
            <input type="text" id="apiToken" placeholder="Your API Token">
            <button id="connectBtn">Connect</button>
            <p id="status">üîå Disconnected</p>
        </div>

        <!-- 2. Balance Tab -->
        <div class="card balance-card">
            <h2>üí∞ Balance</h2>
            <p>Balance: <span id="balance">0.00</span> <span id="currency">USD</span></p>
        </div>

        <!-- 3. Copy Trading Tab -->
        <div class="card copy-trading-card">
            <h2>üìã Copy Trading</h2>
            <input type="text" id="masterToken" placeholder="Copy Account API Token">
            <input type="number" id="copyPercentage" placeholder="Copy %" min="1" max="100" value="100">
            <div class="buttons">
                <button id="startCopyBtn">Add Copy Account</button>
                <button id="stopCopyBtn">Stop All Copy Trading</button>
            </div>
            <div class="copied-accounts">
                <h3>Connected Copy Accounts</h3>
                <div id="copiedAccountsList"></div>
            </div>
        </div>

        <!-- 4. Statistics Tab -->
        <div class="card stats-card">
            <h2>üìà Statistics</h2>
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-label">Winning Trades:</span>
                    <span id="winningTrades">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Losing Trades:</span>
                    <span id="losingTrades">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Total Trades:</span>
                    <span id="totalTrades">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Win Rate:</span>
                    <span id="winRate">0%</span>
                </div>
            </div>
            <div class="profit-loss">
                <p>Total Profit: <span id="totalProfit" class="positive">0.00</span></p>
                <p>Total Loss: <span id="totalLoss" class="negative">0.00</span></p>
                <p>Net P&L: <span id="netPL" class="neutral">0.00</span></p>
            </div>
        </div>

        <!-- 5. Trading Settings Tab -->
        <div class="card settings-card">
            <h2>‚öôÔ∏è Trading Settings</h2>
            <label>Market:</label>
            <select id="market">
                <option value="1HZ10V">Volatility 10 (1HZ10V)</option>
                <option value="1HZ25V">Volatility 25 (1HZ25V)</option>
                <option value="1HZ50V">Volatility 50 (1HZ50V)</option>
                <option value="1HZ75V">Volatility 75 (1HZ75V)</option>
            </select>
            
            <label>Stake Amount:</label>
            <input type="number" id="stake" value="1.00" step="0.01" min="0.35">
            
            <label>Martingale Multiplier:</label>
            <input type="number" id="martingale" value="2.0" step="0.1" min="1.1">
            
            <label>Trade Duration (ticks):</label>
            <input type="number" id="tradeDuration" value="5" min="1" max="5">
            
            <label>Take Profit:</label>
            <input type="number" id="takeProfit" value="10.00" step="0.01">
            
            <label>Stop Loss:</label>
            <input type="number" id="stopLoss" value="10.00" step="0.01">
            
            <div class="buttons">
                <button id="startBtn">Start Bot</button>
                <button id="stopBtn">Stop Bot</button>
            </div>
        </div>

        <!-- 6. Current Trade Tab -->
        <div class="card current-trade-card">
            <h2>üìä Current Trade</h2>
            <p>Last 11 Digits: <span id="lastDigits">--</span></p>
            <p>Predicted Digit: <span id="predictedDigit">--</span></p>
            <p>Current Stake: <span id="currentStakeDisplay">1.00</span></p>
            <p>Status: <span id="countdown">Ready</span></p>
            <p id="lastResult">--</p>
        </div>

        <!-- 7. Trade History Tab -->
        <div class="card history-card">
            <h2>üìã Trade History</h2>
            <button id="clearHistoryBtn">Clear History</button>
            <div id="tradeHistory"></div>
        </div>

        <!-- 8. Activity Log Tab -->
        <div class="card log-card">
            <h2>üìù Activity Log</h2>
            <div id="log"></div>
        </div>
    </div>

    <script>
        let socket;
        let marketTicks = [];
        let isRunning = false;
        let balance = 0;
        let currency = "";
        let currentStake = 1;
        let initialStake = 1;
        let totalProfit = 0;
        let totalLoss = 0;
        let netPL = 0;
        let waiting = false;
        let currentSymbol = "";
        let analysisCountdown = 0;
        let countdownInterval;
        let lossRecoveryMode = false;
        let consecutiveLosses = 0;
        let recoveryTarget = 0;
        let lastPrediction = null;
        let isBalanceSubscribed = false;
        let tradeCooldown = false;

        // Trade Statistics
        let winningTrades = 0;
        let losingTrades = 0;
        let totalTrades = 0;
        let winRate = 0;

        // Copy Trading
        let isCopyTrading = false;
        let copiedAccounts = [];
        let copyPercentage = 100;

        // Trade History
        let tradeHistory = [];

        // New variables for updated logic
        let lastTradedDigit = null; // Track the last digit we traded
        let cooldownTime = 10000; // Default 10 seconds cooldown after trade
        let cooldownTimer = null;
        let cooldownSeconds = 0;
        let cooldownInterval = null;

        document.getElementById("connectBtn").addEventListener("click", connect);
        document.getElementById("startBtn").addEventListener("click", startBot);
        document.getElementById("stopBtn").addEventListener("click", stopBot);
        document.getElementById("clearHistoryBtn").addEventListener("click", clearHistory);
        document.getElementById("startCopyBtn").addEventListener("click", startCopyTrading);
        document.getElementById("stopCopyBtn").addEventListener("click", stopAllCopyTrading);

        function log(message, type = "info") {
          const logDiv = document.getElementById("log");
          const time = new Date().toLocaleTimeString();
          logDiv.innerHTML += `<span class="${type}">[${time}] ${message}</span><br>`;
          logDiv.scrollTop = logDiv.scrollHeight;
        }

        function updateProfitLossDisplay() {
          document.getElementById("totalProfit").textContent = totalProfit.toFixed(2);
          document.getElementById("totalLoss").textContent = totalLoss.toFixed(2);
          document.getElementById("netPL").textContent = netPL.toFixed(2);
          
          const netPLElement = document.getElementById("netPL");
          netPLElement.className = netPL > 0 ? "positive" : netPL < 0 ? "negative" : "neutral";
        }

        function updateTradeStatistics() {
          document.getElementById("winningTrades").textContent = winningTrades;
          document.getElementById("losingTrades").textContent = losingTrades;
          document.getElementById("totalTrades").textContent = totalTrades;
          document.getElementById("winRate").textContent = winRate + "%";
        }

        function calculateWinRate() {
          if (totalTrades === 0) {
            winRate = 0;
          } else {
            winRate = ((winningTrades / totalTrades) * 100).toFixed(1);
          }
          updateTradeStatistics();
        }

        function addToTradeHistory(trade) {
          tradeHistory.unshift(trade);
          if (tradeHistory.length > 20) {
            tradeHistory = tradeHistory.slice(0, 20);
          }
          updateTradeHistoryDisplay();
        }

        function updateTradeHistoryDisplay() {
          const historyDiv = document.getElementById("tradeHistory");
          historyDiv.innerHTML = '';
          
          tradeHistory.forEach(trade => {
            const tradeItem = document.createElement('div');
            tradeItem.className = `trade-item ${trade.result === 'win' ? 'trade-win' : 'trade-loss'}`;
            
            // Create colored P&L text
            const pnlText = trade.result === 'win' ? 
              `+${trade.pnl.toFixed(2)}` : 
              `${trade.pnl.toFixed(2)}`;
            
            tradeItem.innerHTML = `
              <div class="trade-info">
                <div class="trade-main">
                  <strong class="trade-digit">Digit ${trade.digit}</strong>
                  <span class="trade-stake">| ${trade.stake} ${trade.currency}</span>
                </div>
                <div class="trade-pnl ${trade.result === 'win' ? 'win-color' : 'loss-color'}">
                  ${pnlText}
                </div>
              </div>
              <div class="trade-time">
                ${trade.time}
              </div>
            `;
            historyDiv.appendChild(tradeItem);
          });
        }

        function clearHistory() {
          tradeHistory = [];
          winningTrades = 0;
          losingTrades = 0;
          totalTrades = 0;
          totalProfit = 0;
          totalLoss = 0;
          netPL = 0;
          
          updateTradeHistoryDisplay();
          updateProfitLossDisplay();
          calculateWinRate();
          
          document.getElementById("log").innerHTML = '';
          log("üóëÔ∏è All history cleared", "info");
        }

        function startCountdown(seconds, message) {
          analysisCountdown = seconds;
          document.getElementById("countdown").textContent = `${analysisCountdown}s`;
          document.getElementById("countdown").style.color = "#ffd700";
          
          if (countdownInterval) clearInterval(countdownInterval);
          
          countdownInterval = setInterval(() => {
            analysisCountdown--;
            document.getElementById("countdown").textContent = `${analysisCountdown}s`;
            
            if (analysisCountdown <= 0) {
              clearInterval(countdownInterval);
              document.getElementById("countdown").textContent = "Ready";
              document.getElementById("countdown").style.color = "#00e6b8";
              
              if (message && isRunning) {
                log(message, "info");
              }
            }
          }, 1000);
        }

        function startCooldown(duration, tradeType) {
            if (cooldownTimer) {
                clearTimeout(cooldownTimer);
            }
            if (cooldownInterval) {
                clearInterval(cooldownInterval);
            }
            
            tradeCooldown = true;
            cooldownSeconds = duration / 1000;
            
            // Start visual countdown
            updateCooldownDisplay();
            cooldownInterval = setInterval(updateCooldownDisplay, 1000);
            
            log(`‚è≥ ${cooldownSeconds}-second cooldown started after ${tradeType === 'win' ? 'win' : 'loss'}`, "info");
            
            cooldownTimer = setTimeout(() => {
                tradeCooldown = false;
                cooldownTimer = null;
                if (cooldownInterval) {
                    clearInterval(cooldownInterval);
                    cooldownInterval = null;
                }
                
                // Reset analysis data after cooldown
                marketTicks = [];
                document.getElementById("lastDigits").innerText = "--";
                document.getElementById("predictedDigit").innerText = "--";
                
                document.getElementById("countdown").textContent = "Ready";
                document.getElementById("countdown").style.color = "#00e6b8";
                log(`‚úÖ Cooldown period over - Starting fresh analysis`, "info");
            }, duration);
        }

        function updateCooldownDisplay() {
            if (cooldownSeconds > 0) {
                document.getElementById("countdown").textContent = `${cooldownSeconds}s cooldown`;
                document.getElementById("countdown").style.color = "#ffa500";
                cooldownSeconds--;
            }
        }

        function connect() {
          const token = document.getElementById("apiToken").value.trim();
          if (!token) return alert("Enter your API Token!");

          if (socket) {
            socket.close();
          }

          document.getElementById("status").innerText = "üîÑ Connecting...";
          document.getElementById("connectBtn").disabled = true;
          
          socket = new WebSocket("wss://ws.derivws.com/websockets/v3?app_id=1089");

          socket.onopen = () => {
            log("üì° WebSocket connected successfully", "info");
            socket.send(JSON.stringify({ authorize: token }));
          };

          socket.onmessage = (msg) => {
            try {
              const data = JSON.parse(msg.data);

              if (data.error) {
                if (data.error.message && data.error.message.includes('already subscribed to balance')) {
                  isBalanceSubscribed = true;
                  return;
                }
                
                document.getElementById("status").innerText = `‚ùå ${data.error.message}`;
                log(`API Error: ${data.error.message}`, "error");
                document.getElementById("connectBtn").disabled = false;
                return;
              }

              if (data.msg_type === "authorize") {
                document.getElementById("status").innerText = `‚úÖ Connected as ${data.authorize.loginid}`;
                document.getElementById("connectBtn").disabled = false;
                log(`‚úÖ Authorized as ${data.authorize.loginid}`, "info");
                if (!isBalanceSubscribed) {
                  refreshBalance();
                }
              }

              if (data.msg_type === "balance") {
                balance = data.balance.balance;
                currency = data.balance.currency;
                document.getElementById("balance").innerText = balance.toFixed(2);
                document.getElementById("currency").innerText = currency;
              }

              if (data.msg_type === "tick" && isRunning) {
                handleTick(data.tick);
              }

              if (data.msg_type === "proposal") {
                handleProposal(data);
              }

              if (data.msg_type === "buy") {
                handleBuyResponse(data);
              }

              if (data.msg_type === "proposal_open_contract") {
                handleContractUpdate(data);
              }

            } catch (error) {
              log(`‚ùå Parse error: ${error.message}`, "error");
            }
          };

          socket.onerror = (error) => {
            document.getElementById("status").innerText = "‚ùå Connection error";
            document.getElementById("connectBtn").disabled = false;
            log(`WebSocket error: ${error}`, "error");
          };

          socket.onclose = () => {
            document.getElementById("status").innerText = "üîå Disconnected";
            document.getElementById("connectBtn").disabled = false;
            isRunning = false;
            isBalanceSubscribed = false;
            log("WebSocket connection closed", "warning");
          };
        }

        function refreshBalance() {
          if (socket && socket.readyState === WebSocket.OPEN) {
            if (!isBalanceSubscribed) {
              socket.send(JSON.stringify({ balance: 1, subscribe: 1 }));
              isBalanceSubscribed = true;
            } else {
              socket.send(JSON.stringify({ balance: 1 }));
            }
          }
        }

        function startBot() {
          if (!socket || socket.readyState !== WebSocket.OPEN) {
            return alert("Connect to Deriv first!");
          }

          const market = document.getElementById("market").value;
          currentSymbol = market;
          isRunning = true;
          totalProfit = 0;
          totalLoss = 0;
          netPL = 0;
          winningTrades = 0;
          losingTrades = 0;
          totalTrades = 0;
          marketTicks = [];
          consecutiveLosses = 0;
          lossRecoveryMode = false;
          recoveryTarget = 0;
          lastPrediction = null;
          tradeCooldown = false;
          lastTradedDigit = null;
          currentStake = parseFloat(document.getElementById("stake").value);
          initialStake = currentStake;
          
          document.getElementById("lastResult").innerText = "--";
          document.getElementById("predictedDigit").innerText = "--";
          document.getElementById("lastDigits").innerText = "--";
          document.getElementById("countdown").textContent = "Collecting data...";
          document.getElementById("currentStakeDisplay").textContent = currentStake.toFixed(2);
          
          updateProfitLossDisplay();
          calculateWinRate();
          log("üöÄ DAVINA WISE started - Collecting market data...", "info");
          subscribeTicks(market);
        }

        function stopBot() {
          isRunning = false;
          waiting = false;
          lossRecoveryMode = false;
          consecutiveLosses = 0;
          recoveryTarget = 0;
          lastPrediction = null;
          tradeCooldown = false;
          lastTradedDigit = null;
          
          if (countdownInterval) {
            clearInterval(countdownInterval);
          }
          
          if (cooldownTimer) {
            clearTimeout(cooldownTimer);
            cooldownTimer = null;
          }
          
          if (cooldownInterval) {
            clearInterval(cooldownInterval);
            cooldownInterval = null;
          }
          
          document.getElementById("countdown").textContent = "Stopped";
          document.getElementById("countdown").style.color = "#ff6b6b";
          
          unsubscribeTicks();
          log("‚èπ DAVINA WISE stopped manually", "warning");
        }

        function subscribeTicks(symbol) {
          socket.send(JSON.stringify({ 
            ticks_history: symbol, 
            count: 10, 
            end: "latest",
            style: "ticks"
          }));
          
          socket.send(JSON.stringify({ 
            ticks: symbol, 
            subscribe: 1 
          }));
        }

        function unsubscribeTicks() {
          if (socket && socket.readyState === WebSocket.OPEN) {
            socket.send(JSON.stringify({ forget_all: "ticks" }));
          }
        }

        function handleTick(tick) {
          try {
            const quoteStr = tick.quote.toString();
            const digit = parseInt(quoteStr.slice(-1));
            
            // Include ALL digits including 0 - properly handle digit 0
            if (!isNaN(digit) && digit >= 0 && digit <= 9) {
              marketTicks.push(digit);
              
              // Keep only the last 11 digits
              if (marketTicks.length > 11) {
                marketTicks.shift();
              }
              
              // Display all digits including 0 properly - no modification
              document.getElementById("lastDigits").innerText = marketTicks.map(d => d.toString()).join(", ");
              
              // Check for prediction when we have exactly 11 digits and not in cooldown
              if (isRunning && marketTicks.length === 11 && !waiting && !tradeCooldown && !cooldownTimer) {
                const predictionDigit = generatePredictionDigit();
                if (predictionDigit !== null) {
                  document.getElementById("predictedDigit").innerText = predictionDigit;
                  executeTrade(predictionDigit);
                }
              }
            }
          } catch (error) {
            log(`‚ùå Tick handling error: ${error.message}`, "error");
          }
        }

        function generatePredictionDigit() {
          // Check if we have exactly 11 digits
          if (marketTicks.length !== 11) {
            return null;
          }
          
          // Get the last 11 digits
          const last10Digits = marketTicks.slice(0, 10); // First 10 digits (positions 1-10)
          const currentDigit = marketTicks[10]; // 11th digit (most recent)
          
          // Check if the 11th digit is not equal to any of the last 10 digits
          // AND it's different from the last traded digit
          // This includes digit 0 as well - no modification needed
          if (!last10Digits.includes(currentDigit) && currentDigit !== lastTradedDigit) {
            log(`üéØ Prediction found! Digit ${currentDigit} not in last 10 digits: [${last10Digits.join(', ')}] and different from last traded digit ${lastTradedDigit}`, "info");
            return currentDigit;
          }
          
          // No prediction found
          return null;
        }

        function executeTrade(predictedDigit) {
          if (waiting || !isRunning || tradeCooldown || cooldownTimer) return;
          
          waiting = true;
          const stake = currentStake;
          
          refreshBalance();
          
          if (stake > balance) {
            log(`‚ùå Insufficient balance: ${stake} > ${balance}`, "error");
            waiting = false;
            stopBot();
            return;
          }
          
          const tradeDuration = parseInt(document.getElementById("tradeDuration").value);
          
          log(`üìä Executing trade: Digit ${predictedDigit}, Stake: ${stake} ${currency}, Duration: ${tradeDuration} ticks`, "info");
          
          // Store the digit we're about to trade
          lastTradedDigit = predictedDigit;
          
          // Store trade data for copying
          const tradeData = {
            digit: predictedDigit,
            stake: stake,
            duration: tradeDuration,
            symbol: currentSymbol
          };
          
          // Copy trade to all active copy accounts IMMEDIATELY
          copyTradeToAllAccounts(tradeData);
          
          const proposalReq = {
            proposal: 1,
            amount: stake,
            basis: "stake",
            contract_type: "DIGITDIFF",
            currency: currency,
            duration: tradeDuration,
            duration_unit: "t",
            symbol: currentSymbol,
            barrier: predictedDigit.toString()
          };
          
          socket.send(JSON.stringify(proposalReq));
        }

        function handleProposal(data) {
          if (data.error) {
            log(`‚ùå Proposal error: ${data.error.message}`, "error");
            resetAfterTrade();
            return;
          }
          
          const proposal = data.proposal;
          if (proposal) {
            log(`üí∞ Buying contract: ${proposal.longcode}`, "info");
            
            const buyReq = {
              buy: proposal.id,
              price: proposal.ask_price
            };
            
            socket.send(JSON.stringify(buyReq));
          }
        }

        function handleBuyResponse(data) {
          if (data.error) {
            log(`‚ùå Buy error: ${data.error.message}`, "error");
            resetAfterTrade();
            return;
          }
          
          if (data.buy) {
            const contractId = data.buy.contract_id;
            log(`‚úÖ Contract purchased: ${contractId}`, "info");
            
            socket.send(JSON.stringify({ 
              proposal_open_contract: 1, 
              subscribe: 1,
              contract_id: contractId 
            }));
          }
        }

        function handleContractUpdate(data) {
          const contract = data.proposal_open_contract;
          
          if (contract && contract.is_sold) {
            const pnl = parseFloat(contract.profit);
            const status = contract.status;
            const digit = contract.barrier;
            
            refreshBalance();
            
            const trade = {
              digit: digit,
              stake: currentStake,
              currency: currency,
              pnl: pnl,
              result: status,
              time: new Date().toLocaleTimeString()
            };
            addToTradeHistory(trade);
            
            if (status === "won") {
              handleWin(pnl, digit);
            } else if (status === "lost") {
              handleLoss(pnl, digit);
            }
            
            checkLimits();
            
            if (data.subscription && data.subscription.id) {
              socket.send(JSON.stringify({ 
                forget: data.subscription.id 
              }));
            }
          }
        }

        function handleWin(pnl, digit) {
          winningTrades++;
          totalTrades++;
          totalProfit += pnl;
          netPL = totalProfit - totalLoss;
          
          // ALWAYS return to normal stake after any trade
          currentStake = initialStake;
          consecutiveLosses = 0;
          lossRecoveryMode = false;
          recoveryTarget = 0;
          
          document.getElementById("lastResult").innerText = `‚úÖ Won | +${pnl.toFixed(2)} ${currency}`;
          document.getElementById("lastResult").style.color = "#00e6b8";
          log(`üéâ Trade WON! Digit ${digit}, Profit: ${pnl.toFixed(2)} ${currency}`, "win");
          log(`üîÑ Returning to normal stake: ${currentStake.toFixed(2)} ${currency}`, "info");
          
          calculateWinRate();
          updateProfitLossDisplay();
          document.getElementById("currentStakeDisplay").textContent = currentStake.toFixed(2);
          
          // Start 10-second cooldown after WIN
          startCooldown(10000, "win");
          
          waiting = false;
        }

        function handleLoss(pnl, digit) {
          losingTrades++;
          totalTrades++;
          totalLoss += Math.abs(pnl);
          netPL = totalProfit - totalLoss;
          consecutiveLosses++;
          
          const multiplier = parseFloat(document.getElementById("martingale").value);
          
          // Apply martingale multiplier for ONE trade only
          currentStake = initialStake * multiplier;
          
          document.getElementById("lastResult").innerText = `‚ùå Lost | ${pnl.toFixed(2)} ${currency}`;
          document.getElementById("lastResult").style.color = "#ff6b6b";
          log(`üí∏ Trade LOST. Digit ${digit}`, "loss");
          log(`üìà Martingale applied for next trade: ${initialStake} √ó ${multiplier} = ${currentStake.toFixed(2)} ${currency}`, "warning");
          
          calculateWinRate();
          updateProfitLossDisplay();
          document.getElementById("currentStakeDisplay").textContent = currentStake.toFixed(2);
          
          // Start 30-second cooldown after LOSS
          startCooldown(30000, "loss");
          
          waiting = false;
        }

        function resetAfterTrade() {
          waiting = false;
          currentStake = initialStake;
          consecutiveLosses = 0;
          lossRecoveryMode = false;
          recoveryTarget = 0;
          lastPrediction = null;
          document.getElementById("currentStakeDisplay").textContent = currentStake.toFixed(2);
        }

        function checkLimits() {
          const takeProfit = parseFloat(document.getElementById("takeProfit").value);
          const stopLoss = parseFloat(document.getElementById("stopLoss").value);
          
          if (netPL >= takeProfit) {
            log(`üèÅ Take Profit reached: ${netPL.toFixed(2)} >= ${takeProfit}`, "win");
            stopBot();
          } else if (totalLoss >= stopLoss) {
            log(`üõë Stop Loss hit: ${totalLoss.toFixed(2)} >= ${stopLoss}`, "error");
            stopBot();
          }
        }

        // Copy Trading Functions
        function startCopyTrading() {
          const token = document.getElementById("masterToken").value.trim();
          copyPercentage = parseFloat(document.getElementById("copyPercentage").value);
          
          if (!token) {
            alert("Please enter copy account API token!");
            return;
          }
          
          if (copyPercentage < 1 || copyPercentage > 100) {
            alert("Copy percentage must be between 1% and 100%!");
            return;
          }
          
          // Check if account already exists
          let existingAccount = copiedAccounts.find(acc => acc.token === token);
          if (!existingAccount) {
            const account = {
              token: token,
              name: `Copy-${copiedAccounts.length + 1}`,
              status: 'Connecting...',
              percentage: copyPercentage,
              active: false,
              socket: null,
              balance: 0,
              currency: ''
            };
            
            copiedAccounts.push(account);
            updateCopiedAccountsDisplay();
            connectCopyAccount(account);
          } else {
            alert("This account is already being copied!");
          }
          
          document.getElementById("masterToken").value = "";
        }

        function connectCopyAccount(account) {
          try {
            account.socket = new WebSocket("wss://ws.derivws.com/websockets/v3?app_id=1089");
            
            account.socket.onopen = () => {
              log(`üì° Copy account ${account.name} connected`, "copy");
              account.socket.send(JSON.stringify({ authorize: account.token }));
            };
            
            account.socket.onmessage = (msg) => {
              try {
                const data = JSON.parse(msg.data);
                
                if (data.error) {
                  if (data.error.message && data.error.message.includes('already subscribed to balance')) {
                    return;
                  }
                  
                  account.status = `Error: ${data.error.message}`;
                  account.active = false;
                  updateCopiedAccountsDisplay();
                  log(`‚ùå Copy account ${account.name} error: ${data.error.message}`, "error");
                  return;
                }
                
                if (data.msg_type === "authorize") {
                  account.name = data.authorize.loginid;
                  account.status = 'Connected';
                  account.active = true;
                  account.currency = data.authorize.currency;
                  log(`‚úÖ Copy account ${account.name} authorized`, "copy");
                  updateCopiedAccountsDisplay();
                  
                  // Subscribe to balance
                  account.socket.send(JSON.stringify({ balance: 1, subscribe: 1 }));
                }
                
                if (data.msg_type === "balance") {
                  account.balance = data.balance.balance;
                  account.currency = data.balance.currency;
                  updateCopiedAccountsDisplay();
                }
                
                if (data.msg_type === "buy") {
                  if (data.error) {
                    log(`‚ùå Copy trade failed for ${account.name}: ${data.error.message}`, "error");
                  } else {
                    log(`‚úÖ Copy trade executed for ${account.name}`, "copy");
                  }
                }
                
              } catch (error) {
                log(`‚ùå Copy account ${account.name} parse error: ${error.message}`, "error");
              }
            };
            
            account.socket.onerror = (error) => {
              account.status = 'Connection error';
              account.active = false;
              updateCopiedAccountsDisplay();
              log(`‚ùå Copy account ${account.name} connection error`, "error");
            };
            
            account.socket.onclose = () => {
              account.status = 'Disconnected';
              account.active = false;
              updateCopiedAccountsDisplay();
              log(`üîå Copy account ${account.name} disconnected`, "warning");
            };
            
          } catch (error) {
            log(`‚ùå Failed to connect copy account: ${error.message}`, "error");
          }
        }

        function copyTradeToAllAccounts(tradeData) {
          if (copiedAccounts.length === 0) return;
          
          copiedAccounts.forEach(account => {
            if (account.active && account.socket && account.socket.readyState === WebSocket.OPEN) {
              try {
                const copyStake = (tradeData.stake * (account.percentage / 100)).toFixed(2);
                
                if (parseFloat(copyStake) > account.balance) {
                  log(`‚ùå Insufficient balance in copy account ${account.name}: ${copyStake} > ${account.balance}`, "error");
                  return;
                }
                
                log(`üìã Copying trade to ${account.name}: Digit ${tradeData.digit}, Stake: ${copyStake} ${account.currency}`, "copy");
                
                const proposalReq = {
                  proposal: 1,
                  amount: parseFloat(copyStake),
                  basis: "stake",
                  contract_type: "DIGITDIFF",
                  currency: account.currency,
                  duration: tradeData.duration,
                  duration_unit: "t",
                  symbol: tradeData.symbol,
                  barrier: tradeData.digit.toString()
                };
                
                account.socket.send(JSON.stringify(proposalReq));
                
                // Handle the proposal response and execute trade
                const originalOnMessage = account.socket.onmessage;
                account.socket.onmessage = function(msg) {
                  try {
                    const data = JSON.parse(msg.data);
                    
                    if (data.msg_type === "proposal") {
                      if (data.error) {
                        log(`‚ùå Copy proposal error for ${account.name}: ${data.error.message}`, "error");
                      } else if (data.proposal) {
                        const buyReq = {
                          buy: data.proposal.id,
                          price: data.proposal.ask_price
                        };
                        account.socket.send(JSON.stringify(buyReq));
                      }
                    }
                    
                    // Call original handler
                    if (originalOnMessage) {
                      originalOnMessage.call(this, msg);
                    }
                  } catch (error) {
                    log(`‚ùå Copy trade error for ${account.name}: ${error.message}`, "error");
                  }
                };
                
              } catch (error) {
                log(`‚ùå Copy trade failed for ${account.name}: ${error.message}`, "error");
              }
            }
          });
        }

        function stopCopyTradingForAccount(account) {
          if (account.socket) {
            account.socket.close();
          }
          account.active = false;
          account.status = 'Stopped';
          updateCopiedAccountsDisplay();
          log(`‚èπ Copy trading stopped for ${account.name}`, "warning");
        }

        function removeCopyAccount(account) {
          if (account.socket) {
            account.socket.close();
          }
          copiedAccounts = copiedAccounts.filter(acc => acc.token !== account.token);
          updateCopiedAccountsDisplay();
          log(`üóëÔ∏è Copy account ${account.name} removed`, "info");
        }

        function stopAllCopyTrading() {
          copiedAccounts.forEach(account => {
            stopCopyTradingForAccount(account);
          });
          log("‚èπ All copy trading stopped", "warning");
        }

        function updateCopiedAccountsDisplay() {
          const listDiv = document.getElementById("copiedAccountsList");
          listDiv.innerHTML = '';
          
          if (copiedAccounts.length === 0) {
            listDiv.innerHTML = '<p style="color: #888; text-align: center;">No copy accounts connected</p>';
            return;
          }
          
          copiedAccounts.forEach(account => {
            const accountDiv = document.createElement('div');
            accountDiv.className = 'account-item';
            
            accountDiv.innerHTML = `
              <div class="account-info">
                <div class="account-name">${account.name}</div>
                <div class="account-status">${account.status} | Balance: ${account.balance ? account.balance.toFixed(2) : '0.00'} ${account.currency || ''}</div>
              </div>
              <div class="account-controls">
                <button class="start-btn" ${account.active ? 'disabled' : ''}>Start</button>
                <button class="stop-btn" ${!account.active ? 'disabled' : ''}>Stop</button>
                <button class="remove-btn">Remove</button>
              </div>
            `;
            
            const startBtn = accountDiv.querySelector('.start-btn');
            const stopBtn = accountDiv.querySelector('.stop-btn');
            const removeBtn = accountDiv.querySelector('.remove-btn');
            
            startBtn.addEventListener('click', () => {
              if (!account.active) {
                connectCopyAccount(account);
              }
            });
            
            stopBtn.addEventListener('click', () => {
              stopCopyTradingForAccount(account);
            });
            
            removeBtn.addEventListener('click', () => {
              removeCopyAccount(account);
            });
            
            listDiv.appendChild(accountDiv);
          });
        }

        // Input validation
        document.getElementById('stake').addEventListener('change', function() {
          const stake = parseFloat(this.value);
          if (stake < 0.35) {
            this.value = 0.35;
            alert('Minimum stake is 0.35');
          }
          initialStake = parseFloat(this.value);
          currentStake = initialStake;
          document.getElementById("currentStakeDisplay").textContent = currentStake.toFixed(2);
        });

        document.getElementById('martingale').addEventListener('change', function() {
          const multiplier = parseFloat(this.value);
          if (multiplier < 1.1) {
            this.value = 2.0;
            alert('Multiplier must be at least 1.1');
          }
        });

        document.getElementById('tradeDuration').addEventListener('change', function() {
          const duration = parseInt(this.value);
          if (duration < 1) {
            this.value = 1;
            alert('Minimum duration is 1 tick');
          } else if (duration > 5) {
            this.value = 5;
            alert('Maximum duration is 5 ticks');
          }
        });

        // Initialize display
        document.getElementById("currentStakeDisplay").textContent = "1.00";
        updateProfitLossDisplay();
        calculateWinRate();
        updateCopiedAccountsDisplay();
    </script>
</body>
</html>                                                                                      <value name="A">
                                                                                                  <block type="logic_compare" id="oO`CQQJPC@??So~6EAJr">
                                                                                                    <field name="OP">NEQ</field>
                                                                                                    <value name="A">
                                                                                                      <block type="variables_get" id="O1eQkI6lQbB1e^yj=]CN">
                                                                                                        <field name="VAR" id="72(O*_Q.LBh|~qj+Q`I8">DIGIT 11</field>
                                                                                                      </block>
                                                                                                    </value>
                                                                                                    <value name="B">
                                                                                                      <block type="variables_get" id="=;er(L}ttoCyHi*|H2Z9">
                                                                                                        <field name="VAR" id="Q$?9%Qd!{#?wG:A*p(M!">DIGIT 6</field>
                                                                                                      </block>
                                                                                                    </value>
                                                                                                  </block>
                                                                                                </value>
                                                                                                <value name="B">
                                                                                                  <block type="logic_operation" id="N!Ma*F#sfn2`1#,jJkhM">
                                                                                                    <field name="OP">AND</field>
                                                                                                    <value name="A">
                                                                                                      <block type="logic_compare" id="%Hu(;GFu.~L@/42QtW.9">
                                                                                                        <field name="OP">NEQ</field>
                                                                                                        <value name="A">
                                                                                                          <block type="variables_get" id="kj_RCJB8ZS1.D(pjlTab">
                                                                                                            <field name="VAR" id="72(O*_Q.LBh|~qj+Q`I8">DIGIT 11</field>
                                                                                                          </block>
                                                                                                        </value>
                                                                                                        <value name="B">
                                                                                                          <block type="variables_get" id="%enTC*|089@L2p.vDb{U">
                                                                                                            <field name="VAR" id="8hY*}cSm:R9NH~NTJ:Qm">DIGIT 5</field>
                                                                                                          </block>
                                                                                                        </value>
                                                                                                      </block>
                                                                                                    </value>
                                                                                                    <value name="B">
                                                                                                      <block type="logic_operation" id="t/_Rh]f0]`E(0CD={4H.">
                                                                                                        <field name="OP">AND</field>
                                                                                                        <value name="A">
                                                                                                          <block type="logic_compare" id="B|H/`!0Po%,YVsK=xroQ">
                                                                                                            <field name="OP">NEQ</field>
                                                                                                            <value name="A">
                                                                                                              <block type="variables_get" id="R0HEuE7.$Xi~sg~t9Y6f">
                                                                                                                <field name="VAR" id="72(O*_Q.LBh|~qj+Q`I8">DIGIT 11</field>
                                                                                                              </block>
                                                                                                            </value>
                                                                                                            <value name="B">
                                                                                                              <block type="variables_get" id="Q^d?ue^3FArWR0qS9XTT">
                                                                                                                <field name="VAR" id="SBoDD41V@q:X)T/A^DHM">DIGIT 4</field>
                                                                                                              </block>
                                                                                                            </value>
                                                                                                          </block>
                                                                                                        </value>
                                                                                                        <value name="B">
                                                                                                          <block type="logic_operation" id="6#yeCZ?(v)ol2z7CYswj">
                                                                                                            <field name="OP">AND</field>
                                                                                                            <value name="A">
                                                                                                              <block type="logic_compare" id="YtQA~{(1`r,1g]?e%nsP">
                                                                                                                <field name="OP">NEQ</field>
                                                                                                                <value name="A">
                                                                                                                  <block type="variables_get" id="ogN`3m^kt,|##-;KX#15">
                                                                                                                    <field name="VAR" id="72(O*_Q.LBh|~qj+Q`I8">DIGIT 11</field>
                                                                                                                  </block>
                                                                                                                </value>
                                                                                                                <value name="B">
                                                                                                                  <block type="variables_get" id="pym=%,qgQPaYDfwfvMAU">
                                                                                                                    <field name="VAR" id="0A1n%TctnaK]!M7{+Qa,">DIGIT 3</field>
                                                                                                                  </block>
                                                                                                                </value>
                                                                                                              </block>
                                                                                                            </value>
                                                                                                            <value name="B">
                                                                                                              <block type="logic_operation" id="Xfi*r0t;|,9Umw1PX%if">
                                                                                                                <field name="OP">AND</field>
                                                                                                                <value name="A">
                                                                                                                  <block type="logic_compare" id="^3O=Xz*hNmwj)~vgVNt#">
                                                                                                                    <field name="OP">NEQ</field>
                                                                                                                    <value name="A">
                                                                                                                      <block type="variables_get" id="/^Dvi]0V6X7yU5w28s/c">
                                                                                                                        <field name="VAR" id="72(O*_Q.LBh|~qj+Q`I8">DIGIT 11</field>
                                                                                                                      </block>
                                                                                                                    </value>
                                                                                                                    <value name="B">
                                                                                                                      <block type="variables_get" id="Cn)47I8:`#RJ2[x~e3{-">
                                                                                                                        <field name="VAR" id="y5heCMzC_KJ:V[@8|UwZ">DIGIT 2</field>
                                                                                                                      </block>
                                                                                                                    </value>
                                                                                                                  </block>
                                                                                                                </value>
                                                                                                                <value name="B">
                                                                                                                  <block type="logic_compare" id="k3t*S=sM%wWa.oJf%Avz">
                                                                                                                    <field name="OP">NEQ</field>
                                                                                                                    <value name="A">
                                                                                                                      <block type="variables_get" id="+[8dIuwVIz)O=_3UlWek">
                                                                                                                        <field name="VAR" id="72(O*_Q.LBh|~qj+Q`I8">DIGIT 11</field>
                                                                                                                      </block>
                                                                                                                    </value>
                                                                                                                    <value name="B">
                                                                                                                      <block type="variables_get" id="O~tK4b8)QF5=md5@xo5.">
                                                                                                                        <field name="VAR" id="94}O#yIne[J^)D;@W@Uh">DIGIT 1</field>
                                                                                                                      </block>
                                                                                                                    </value>
                                                                                                                  </block>
                                                                                                                </value>
                                                                                                              </block>
                                                                                                            </value>
                                                                                                          </block>
                                                                                                        </value>
                                                                                                      </block>
                                                                                                    </value>
                                                                                                  </block>
                                                                                                </value>
                                                                                              </block>
                                                                                            </value>
                                                                                          </block>
                                                                                        </value>
                                                                                      </block>
                                                                                    </value>
                                                                                  </block>
                                                                                </value>
                                                                              </block>
                                                                            </value>
                                                                          </block>
                                                                        </value>
                                                                        <statement name="DO0">
                                                                          <block type="variables_set" id="5:[^L-g9`M+PNN7.#o2x">
                                                                            <field name="VAR" id="A=OK@}%RAFGH$vqtRWTd">PREDICTION</field>
                                                                            <value name="VALUE">
                                                                              <block type="variables_get" id=";}lEQTpuzuv_0=_Ifp;{">
                                                                                <field name="VAR" id="72(O*_Q.LBh|~qj+Q`I8">DIGIT 11</field>
                                                                              </block>
                                                                            </value>
                                                                            <next>
                                                                              <block type="controls_flow_statements" id="A6ry8T5f763BCkM!7zy=">
                                                                                <field name="FLOW">BREAK</field>
                                                                              </block>
                                                                            </next>
                                                                          </block>
                                                                        </statement>
                                                                      </block>
                                                                    </next>
                                                                  </block>
                                                                </next>
                                                              </block>
                                                            </next>
                                                          </block>
                                                        </next>
                                                      </block>
                                                    </next>
                                                  </block>
                                                </next>
                                              </block>
                                            </next>
                                          </block>
                                        </next>
                                      </block>
                                    </next>
                                  </block>
                                </next>
                              </block>
                            </next>
                          </block>
                        </next>
                      </block>
                    </next>
                  </block>
                </next>
              </block>
            </statement>
            <value name="SECONDS">
              <block type="math_number" id="7Srt;YI16):),uk5JCL2">
                <field name="NUM">0</field>
              </block>
            </value>
          </block>
        </statement>
        <next>
          <block type="trade_definition_tradeoptions" id="eFg:^m{OviEyRp=u(~4(">
            <mutation xmlns="http://www.w3.org/1999/xhtml" has_first_barrier="false" has_second_barrier="false" has_prediction="true"></mutation>
            <field name="DURATIONTYPE_LIST">t</field>
            <value name="DURATION">
              <shadow type="math_number_positive" id="?.7aPv]miGZM7Fr?8N(2">
                <field name="NUM">1</field>
              </shadow>
              <block type="variables_get" id=",Dtn7@04j#VBPq6~-zHw">
                <field name="VAR" id=";zb+7tjxSd`a8Ty+#}!b">ticks</field>
              </block>
            </value>
            <value name="AMOUNT">
              <shadow type="math_number_positive" id="c`}~IVwZPzv6_V(a=sr}">
                <field name="NUM">0.35</field>
              </shadow>
              <block type="variables_get" id="_;VSPWm=3J6zE(R,!~Fy">
                <field name="VAR" id="Fjwk@#07}q2[mq0Y(--p">STAKE</field>
              </block>
            </value>
            <value name="PREDICTION">
              <shadow type="math_number_positive" id="-VGH:5fd:n/xt?W*(@cS" inline="true">
                <field name="NUM">1</field>
              </shadow>
              <block type="variables_get" id="0TmSN8:.*b5YVj/Hemt7">
                <field name="VAR" id="A=OK@}%RAFGH$vqtRWTd">PREDICTION</field>
              </block>
            </value>
          </block>
        </next>
      </block>
    </statement>
  </block>
  <block type="after_purchase" id="/gG?J^l`KWGsZ=sbG}zp" x="941" y="110">
    <statement name="AFTERPURCHASE_STACK">
      <block type="controls_if" id="Hm[,!/T|$;dl@4dJ%/Dc">
        <mutation xmlns="http://www.w3.org/1999/xhtml" elseif="1" else="1"></mutation>
        <value name="IF0">
          <block type="logic_compare" id="($~r`].f#~t.FA.ne_2d">
            <field name="OP">GTE</field>
            <value name="A">
              <block type="total_profit" id="f8~k5lr1~)-1d?g`LTOc"></block>
            </value>
            <value name="B">
              <block type="variables_get" id="84/847n!9|[v]3N)T7M4">
                <field name="VAR" id="xn8O=yZE:q=uC]2_03v;">TAKE PROFIT</field>
              </block>
            </value>
          </block>
        </value>
        <statement name="DO0">
          <block type="text_print" id="X^yj3JHCU=U/B0AzT[Up">
            <value name="TEXT">
              <shadow type="text" id="_`#j_N1Zb%+mQWntD*1K">
                <field name="TEXT">DAVINA</field>
              </shadow>
            </value>
          </block>
        </statement>
        <value name="IF1">
          <block type="logic_compare" id="u4g-m!?on/:uP_F4LEPj">
            <field name="OP">LTE</field>
            <value name="A">
              <block type="total_profit" id="gfa/tQ#WEIv}4$)@pXCE"></block>
            </value>
            <value name="B">
              <block type="math_single" id=")m=o*t1~,/b;sk|ulyob">
                <field name="OP">NEG</field>
                <value name="NUM">
                  <shadow type="math_number" id="L^(?jh=jt?,97Q6`w349">
                    <field name="NUM">9</field>
                  </shadow>
                  <block type="variables_get" id="?[PLavKkNT]^T=TTl]8n">
                    <field name="VAR" id="]GS/lo7@?k]KS0lZm$58">STOP LOSS</field>
                  </block>
                </value>
              </block>
            </value>
          </block>
        </value>
        <statement name="DO1">
          <block type="text_print" id="`T!?$|DhaZ7v_$$Ews(}">
            <value name="TEXT">
              <shadow type="text" id="pO5K_Nm-!TaCvKX0K`Iz">
                <field name="TEXT">LOSS</field>
              </shadow>
            </value>
          </block>
        </statement>
        <statement name="ELSE">
          <block type="controls_if" id="MzSi)Q|8rJF_I;@xX/S+">
            <mutation xmlns="http://www.w3.org/1999/xhtml" else="1"></mutation>
            <value name="IF0">
              <block type="contract_check_result" id="axMW(U=gX$fL:N%rkHuL">
                <field name="CHECK_RESULT">win</field>
              </block>
            </value>
            <statement name="DO0">
              <block type="variables_set" id="//XSKOTKR89)mp;p:uqo">
                <field name="VAR" id="Fjwk@#07}q2[mq0Y(--p">STAKE</field>
                <value name="VALUE">
                  <block type="variables_get" id="zO{|1cSZ};DwtcU0G=`V">
                    <field name="VAR" id="ZXHs]L492=%}iJpQ!.P$">INITIAL STAKE</field>
                  </block>
                </value>
              </block>
            </statement>
            <statement name="ELSE">
              <block type="timeout" id="qMzcU?cP.1^rSQB]ubIk">
                <statement name="TIMEOUTSTACK">
                  <block type="variables_set" id="WGSgG61sp.-O3dxW=d7e">
                    <field name="VAR" id="Fjwk@#07}q2[mq0Y(--p">STAKE</field>
                    <value name="VALUE">
                      <block type="math_arithmetic" id="%rjac{vE:n9mX?=xHplU">
                        <field name="OP">MULTIPLY</field>
                        <value name="A">
                          <shadow type="math_number" id="Oj!4q.im1eLdhh{lNRGO">
                            <field name="NUM">1</field>
                          </shadow>
                          <block type="variables_get" id="w=7O/T%v~-=}%#w=i6JP">
                            <field name="VAR" id="Fjwk@#07}q2[mq0Y(--p">STAKE</field>
                          </block>
                        </value>
                        <value name="B">
                          <shadow type="math_number" id="kK3,hwgEev~Mip.dTTaR">
                            <field name="NUM">1</field>
                          </shadow>
                          <block type="variables_get" id="?`:Edej7UID7BkLtY.va">
                            <field name="VAR" id="#~R,uz:m-e/vsiI]suMz">MARTINGALE</field>
                          </block>
                        </value>
                      </block>
                    </value>
                  </block>
                </statement>
                <value name="SECONDS">
                  <block type="math_number" id="%Z@jnZ.oxy$2Ul.JnSdI">
                    <field name="NUM">5</field>
                  </block>
                </value>
              </block>
            </statement>
            <next>
              <block type="trade_again" id="pj2YjfHN`X^?Zz[T/!sz"></block>
            </next>
          </block>
        </statement>
      </block>
    </statement>
  </block>
  <block type="before_purchase" id="/1|zKc|EhbPc*Wk/H{I." deletable="false" x="0" y="2128">
    <statement name="BEFOREPURCHASE_STACK">
      <block type="purchase" id="/,G%hTNP-1c3a+f*aj%X">
        <field name="PURCHASE_LIST">DIGITDIFF</field>
      </block>
    </statement>
  </block>
</xml>